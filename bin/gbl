#! /usr/bin/ruby 

require 'optparse'

options = {}
OptionParser.new do |opts|
opts.banner = "Usage: ghl [options]"

opts.on("-d", "--to-delete", "Only display branches to delete") do |v|
  options[:to_delete] = 1
end

opts.on("-v", "--version", "Version") do |v|
  options[:version] = 1
end

end.parse!

#p options
#p ARGV

if options.include? :version
  puts "0.1.3"
  exit
end

def remote_branches
  branches = []
  output = `git branch -r`
  output.each_line do |line|
    branches << line.strip
  end
  branches.delete_at(0)
  branches
end

def diff_branches br1, br2
  name1 = br1.gsub /origin\//, ""
  name2 = br2.gsub /origin\//, ""
  ahead = `git rev-list #{br1}..#{br2} | wc -l`
  behind = `git rev-list #{br2}..#{br1} | wc -l`
  puts "#{name2} from #{name1} is #{ahead.strip} ahead "
  puts "#{name2} from #{name1} is #{behind.strip} behind "
  puts 
end

def diff_all_branhces_with_master
  branches = remote_branches
  branches.each do |br|
    diff_branches "origin/master", br
  end
end

diff_all_branhces_with_master
